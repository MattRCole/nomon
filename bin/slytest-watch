#! /usr/bin/env bash

scriptDir="${0:a:h}"
source "${scriptDir}/__util.source"

fswatchPrereqCheck() {
    which fswatch > /dev/null 2>&1

    fsWatchResult="$?"

    if [ "$fsWatchResult" -ne 0 ]
    then
        echo "you must install fswatch to use slytest-watch. you can do this by running: 'brew install fswatch'"
        exit 1
    fi
}

source "${scriptDir}/__slytest-watch-args.source"


fswatchPrereqCheck
escapedCommand=$(escapeAllArgs "$@")

runInBackground sh -c "$scriptDir/__run.sh $escapedCommand"

myPid=$?

echo myPid=$myPid

sleep 1 && echo "killing..." && kill $myPid

